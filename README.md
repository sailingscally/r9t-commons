# Common Functionality

Before you know it, you have a `sleep()` method scattered across most of your modules, how did this happen,
you ask yourself. This isn't your first software project, you know it will happen if you don't get organised.

This Node.JS module is meant to solve this and other problems. It is the place for common functionality and
shared resources across all R nineT navigation tower microservices / modules.

## Enumerations

- `WeatherAlert` - contains all possible weather alerts generated by the
[r9t-storm](https://github.com/sailingscally/r9t-storm) microservice, each represented by a binary value so
they can be combined (ex: storm with strong wind, rain and wind, etc.)

```JavaScript
const WeatherAlert = {
  NONE:                0b00000000,
  POOR:                0b00000001,
  RAIN:                0b00000010,
  WIND:                0b00000100,
  STRONG_WIND:         0b00001000,
  GALE:                0b00010000,
  STORM:               0b00100000,
  FIRESTORM:           0b01000000,
  SEVERE_THUNDERSTORM: 0b10000000
}
```

## Methods

- `sleep(ms)` - causes the code to sleep for the specified number of milliseconds
- `arg(name)` - returns the value for the given command line argument, converts to number if it is a number
- `profiler.start(key)` - starts a profiling timer with a given key
- `profiler.stop(key)` - stops the profiling timer and logs the time spent for this operation

## Properties

- `logger` - exposes the [pino](https://getpino.io/) logger to be used across all modules in this project.

## Logging

When running a Node.JS application from the console, the [pino](https://getpino.io/) logger will be
configured to use [pino-pretty](https://github.com/pinojs/pino-pretty) to improve readability. When running
in *production* mode under [PM2](https://pm2.keymetrics.io/), no pretty printing will be used.

## Tests & Coverage

[Jest](https://jestjs.io/) is used to implement unit tests and provide test coverage reports on this module.

To run both unit tests and get a test coverage report, just run:

```
npm test
```

The module `babel-plugin-rewire` is necessary to run tests on non exported methods and still be able to get
test coverage reports on these. Using `rewire` would cause the test coverage to fail.

## Code Linting

[ESLint](https://eslint.org/) is used for code linting, mostly based on the
[google](https://www.npmjs.com/package/eslint-config-google) config rules, with some tweaks to match my own
coding style. Choosing ESlint was mostly due to the flexibility it offers (*StandardJS* is too opinionated
with no config options) and the fact that it is
[much more popular](https://npmtrends.com/eslint-vs-jscs-vs-jshint-vs-jslint).

To get a report run:

```
npm run lint
```

## Usage

This module isn't published to the NPM registry and needs to be installed from GitHub with the command:

```
npm install https://github.com/sailingscally/r9t-commons
```
